<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Iniciar Sesión - Sistema de Alquileres</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body {
        margin: 0;
        overflow: hidden;
      }

      #canvas {
        position: absolute;
        top: 0;
        left: 0;
        background: #1e293b;
      }
    </style>
  </head>
  <body
    class="min-h-screen flex items-center justify-center bg-[#fcf8f4] dark:bg-gray-900"
  >
    <canvas id="canvas" class="fixed inset-0 w-full h-full z-0"></canvas>
    <!-- Contenedor del login -->
    <div
      class="min-h-screen flex items-center justify-center p-4 relative z-10"
    >
      <div class="w-full max-w-md">
        <!-- Card principal -->
        <div
          class="bg-white/95 dark:bg-gray-800/95 backdrop-blur-xl rounded-3xl shadow-2xl p-8"
        >
          <!-- Icono -->
          <div class="flex justify-center mb-6">
            <div
              class="w-20 h-20 bg-gradient-to-br from-orange-400 to-orange-500 rounded-2xl flex items-center justify-center shadow-lg"
            >
              <svg
                class="w-10 h-10 text-white"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"
                />
              </svg>
            </div>
          </div>
          <!-- Título -->
          <h1
            class="text-3xl font-bold text-gray-800 dark:text-gray-100 text-center mb-2"
          >
            Iniciar Sesión
          </h1>
          <p class="text-gray-500 dark:text-gray-300 text-center mb-8">
            Sistema de Gestión de Alquileres
          </p>
          <!-- Formulario -->
          {% if error %}
          <div class="mb-4 text-center text-red-600 font-semibold">
            {{ error }}
          </div>
          {% endif %}
          <form method="POST" class="space-y-5">
            {{ form.csrf_token }}
            <!-- Campo Email -->
            <div>
              <label
                class="block text-gray-700 dark:text-gray-200 text-sm font-medium mb-2"
                >Usuario</label
              >
              <div class="relative">
                <div
                  class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    class="h-5 w-5 icon icon-tabler icons-tabler-outline icon-tabler-user text-gray-400"
                  >
                    <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                    <path d="M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0" />
                    <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
                  </svg>
                </div>
                <input
                  type="text"
                  name="usuario"
                  class="w-full pl-12 pr-4 py-3.5 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-xl focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent transition text-gray-700 dark:text-gray-100"
                  placeholder="Usuario"
                  required
                />
              </div>
            </div>
            <!-- Campo Contraseña -->
            <div>
              <label
                class="block text-gray-700 dark:text-gray-200 text-sm font-medium mb-2"
                >Contraseña</label
              >
              <div class="relative">
                <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none z-10">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 dark:text-gray-400" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
                    <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                    <rect x="5" y="11" width="14" height="7" rx="2" />
                    <path d="M7 11v-2a5 5 0 0110 0v2" />
                    <path d="M12 15v.01" />
                  </svg>
                </div>
                <input
                  id="login-password"
                  type="password"
                  name="password"
                  autocomplete="current-password"
                  class="w-full pl-12 pr-10 py-3.5 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-xl focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent transition text-gray-700 dark:text-gray-100"
                  placeholder="••••••••"
                  required
                />
                <button type="button" id="login-toggle" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 dark:text-gray-300 z-20" aria-label="Mostrar contraseña">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5" aria-hidden="true">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8S1 12 1 12z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                  </svg>
                </button>
              </div>
              </div>
            </div>
            <!-- Botón Iniciar Sesión -->
            <div class="flex items-center justify-between">
              <label class="inline-flex items-center text-sm text-gray-600 dark:text-gray-300">
                <input type="checkbox" name="remember" class="form-checkbox h-4 w-4 text-orange-600" />
                <span class="ml-2">Mantener sesión iniciada</span>
              </label>
            </div>

            <button
              type="submit"
              class="w-full bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white font-semibold py-3.5 rounded-xl transition duration-200 shadow-lg shadow-orange-300 dark:shadow-orange-900 hover:shadow-xl hover:shadow-orange-400 dark:hover:shadow-orange-900 hover:scale-105 transform mt-6"
            >
              Iniciar Sesión
            </button>
          </form>
        </div>
      </div>
    </div>

    <script>
      const canvas = document.getElementById('canvas');
      const ctx = canvas.getContext('2d');

      function getParticleColor() {
        // Detecta si el modo oscuro está activo
        return window.matchMedia('(prefers-color-scheme: dark)').matches
          ? 'rgba(251, 191, 36, 0.8)' // amarillo para modo oscuro
          : 'rgba(249, 115, 22, 0.8)'; // naranja para modo claro
      }

      function getLineColor(opacity) {
        return window.matchMedia('(prefers-color-scheme: dark)').matches
          ? `rgba(251, 191, 36, ${opacity * 0.5})` // amarillo para modo oscuro
          : `rgba(249, 115, 22, ${opacity * 0.5})`; // naranja para modo claro
      }

      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;

      window.addEventListener('resize', () => {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        initParticles();
      });

      const mouse = {
        x: null,
        y: null,
        radius: 150,
      };

      window.addEventListener('mousemove', (e) => {
        mouse.x = e.x;
        mouse.y = e.y;
      });

      window.addEventListener('touchmove', (e) => {
        mouse.x = e.touches[0].clientX;
        mouse.y = e.touches[0].clientY;
      });

      window.addEventListener('mouseout', () => {
        mouse.x = null;
        mouse.y = null;
      });

      class Particle {
        constructor() {
          this.x = Math.random() * canvas.width;
          this.y = Math.random() * canvas.height;
          this.size = Math.random() * 3 + 1;
          this.baseX = this.x;
          this.baseY = this.y;
          this.density = Math.random() * 30 + 1;
          this.vx = Math.random() * 0.5 - 0.25;
          this.vy = Math.random() * 0.5 - 0.25;
        }

        draw() {
          ctx.fillStyle = getParticleColor();
          ctx.beginPath();
          ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
          ctx.closePath();
          ctx.fill();
        }

        update() {
          // Movimiento base
          this.baseX += this.vx;
          this.baseY += this.vy;

          // Rebote en los bordes
          if (this.baseX < 0 || this.baseX > canvas.width) this.vx *= -1;
          if (this.baseY < 0 || this.baseY > canvas.height) this.vy *= -1;

          // Interacción con el cursor
          let dx = mouse.x - this.baseX;
          let dy = mouse.y - this.baseY;
          let distance = Math.sqrt(dx * dx + dy * dy);
          let forceDirectionX = dx / distance;
          let forceDirectionY = dy / distance;
          let maxDistance = mouse.radius;
          let force = (maxDistance - distance) / maxDistance;
          let directionX = forceDirectionX * force * this.density;
          let directionY = forceDirectionY * force * this.density;

          if (distance < mouse.radius) {
            this.x -= directionX;
            this.y -= directionY;
          } else {
            if (this.x !== this.baseX) {
              let dx = this.x - this.baseX;
              this.x -= dx / 10;
            }
            if (this.y !== this.baseY) {
              let dy = this.y - this.baseY;
              this.y -= dy / 10;
            }
          }
        }
      }

      let particles = [];

      function initParticles() {
        particles = [];
        let numberOfParticles = (canvas.width * canvas.height) / 9000;
        for (let i = 0; i < numberOfParticles; i++) {
          particles.push(new Particle());
        }
      }

      function connect() {
        for (let a = 0; a < particles.length; a++) {
          for (let b = a; b < particles.length; b++) {
            let dx = particles[a].x - particles[b].x;
            let dy = particles[a].y - particles[b].y;
            let distance = Math.sqrt(dx * dx + dy * dy);

            if (distance < 120) {
              let opacity = 1 - distance / 120;
              ctx.strokeStyle = getLineColor(opacity);
              ctx.lineWidth = 1;
              ctx.beginPath();
              ctx.moveTo(particles[a].x, particles[a].y);
              ctx.lineTo(particles[b].x, particles[b].y);
              ctx.stroke();
            }
          }
        }
      }

      function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        for (let i = 0; i < particles.length; i++) {
          particles[i].update();
          particles[i].draw();
        }

        connect();
        requestAnimationFrame(animate);
      }

      // Detecta cambios en el modo oscuro y actualiza el fondo
      window
        .matchMedia('(prefers-color-scheme: dark)')
        .addEventListener('change', () => {
          animate();
        });

      initParticles();
      animate();
    </script>
    <script>
      // Toggle mostrar/ocultar contraseña en el login
      (function(){
        const pw = document.getElementById('login-password');
        const btn = document.getElementById('login-toggle');
        if (!pw || !btn) return;

        const svgShow = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5" aria-hidden="true">\n                      <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8S1 12 1 12z"></path>\n                      <circle cx="12" cy="12" r="3"></circle>\n                    </svg>';
        const svgHide = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5" aria-hidden="true">\n                      <path d="M17.94 17.94A10.94 10.94 0 0 1 12 20c-7 0-11-8-11-8a21.86 21.86 0 0 1 5-6.11"></path>\n                      <path d="M3 3l18 18"></path>\n                      <path d="M9.88 9.88a3 3 0 0 0 4.24 4.24"></path>\n                    </svg>';

        btn.innerHTML = svgShow;
        // prevent focus steal
        btn.addEventListener('mousedown', function(e){ e.preventDefault(); });
        btn.addEventListener('click', function(){
          const start = pw.selectionStart;
          const end = pw.selectionEnd;
          if (pw.type === 'password') {
            pw.type = 'text';
            btn.innerHTML = svgHide;
            btn.setAttribute('aria-label','Ocultar contraseña');
            btn.classList.add('active');
          } else {
            pw.type = 'password';
            btn.innerHTML = svgShow;
            btn.setAttribute('aria-label','Mostrar contraseña');
            btn.classList.remove('active');
          }
          pw.focus();
          try { pw.setSelectionRange(start, end); } catch (e) {}
        });
      })();
    </script>
  </body>
</html>
